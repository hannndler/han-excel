"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("exceljs"),e=require("file-saver");class s{listeners=new Map;on(t,e,s={}){this.listeners.has(t)||this.listeners.set(t,[]);const r={type:t,listener:e,options:{once:!1,async:!1,priority:0,stopPropagation:!1,...s},id:this.generateId(),active:!0,timestamp:new Date};return this.listeners.get(t).push(r),this.listeners.get(t).sort((t,e)=>(e.options.priority||0)-(t.options.priority||0)),r.id}once(t,e,s={}){return this.on(t,e,{...s,once:!0})}off(t,e){const s=this.listeners.get(t);if(!s)return!1;const r=s.findIndex(t=>t.id===e);return-1!==r&&(s.splice(r,1),!0)}offAll(t){const e=this.listeners.get(t);if(!e)return 0;const s=e.length;return this.listeners.delete(t),s}async emit(t){const e=t.type||"default",s=this.listeners.get(e);if(!s||0===s.length)return;const r=s.filter(t=>t.active);for(const o of r)try{if(o.options.once&&(o.active=!1),o.options.async?await o.listener(t):o.listener(t),o.options.stopPropagation)break}catch(i){console.error(`Error in event listener for ${e}:`,i)}this.cleanupInactiveListeners(e)}emitSync(t){const e=t.type||"default",s=this.listeners.get(e);if(!s||0===s.length)return;const r=s.filter(t=>t.active);for(const o of r)try{if(o.options.once&&(o.active=!1),o.listener(t),o.options.stopPropagation)break}catch(i){console.error(`Error in event listener for ${e}:`,i)}this.cleanupInactiveListeners(e)}clear(){this.listeners.clear()}getListeners(t){return this.listeners.get(t)||[]}getListenerCount(t){return this.listeners.get(t)?.length||0}getEventTypes(){return Array.from(this.listeners.keys())}generateId(){return Math.random().toString(36).substr(2,9)}cleanupInactiveListeners(t){const e=this.listeners.get(t);if(e){const s=e.filter(t=>t.active);s.length!==e.length&&this.listeners.set(t,s)}}}var r=(t=>(t.STRING="string",t.NUMBER="number",t.BOOLEAN="boolean",t.DATE="date",t.PERCENTAGE="percentage",t.CURRENCY="currency",t.LINK="link",t.FORMULA="formula",t))(r||{}),i=(t=>(t.GENERAL="General",t.NUMBER="#,##0",t.NUMBER_DECIMALS="#,##0.00",t.CURRENCY="$#,##0.00",t.CURRENCY_INTEGER="$#,##0",t.PERCENTAGE="0%",t.PERCENTAGE_DECIMALS="0.00%",t.DATE="dd/mm/yyyy",t.DATE_TIME="dd/mm/yyyy hh:mm",t.TIME="hh:mm:ss",t.CUSTOM="custom",t))(i||{}),o=(t=>(t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.FILL="fill",t.JUSTIFY="justify",t.CENTER_CONTINUOUS="centerContinuous",t.DISTRIBUTED="distributed",t))(o||{}),n=(t=>(t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom",t.DISTRIBUTED="distributed",t.JUSTIFY="justify",t))(n||{}),l=(t=>(t.THIN="thin",t.MEDIUM="medium",t.THICK="thick",t.DOTTED="dotted",t.DASHED="dashed",t.DOUBLE="double",t.HAIR="hair",t.MEDIUM_DASHED="mediumDashed",t.DASH_DOT="dashDot",t.MEDIUM_DASH_DOT="mediumDashDot",t.DASH_DOT_DOT="dashDotDot",t.MEDIUM_DASH_DOT_DOT="mediumDashDotDot",t.SLANT_DASH_DOT="slantDashDot",t))(l||{}),a=(t=>(t.NORMAL="normal",t.BOLD="bold",t.ITALIC="italic",t.BOLD_ITALIC="bold italic",t))(a||{}),h=(t=>(t.VALIDATION_ERROR="VALIDATION_ERROR",t.BUILD_ERROR="BUILD_ERROR",t.STYLE_ERROR="STYLE_ERROR",t.WORKSHEET_ERROR="WORKSHEET_ERROR",t.CELL_ERROR="CELL_ERROR",t))(h||{});class d{config;tables=[];currentRow=1;currentCol=1;headerPointers=new Map;isBuilt=!1;headers=[];subHeaders=[];body=[];footers=[];constructor(t){this.config=t}addHeader(t){return this.headers.push(t),this}addSubHeaders(t){return this.subHeaders.push(...t),this}addRow(t){return Array.isArray(t)?this.body.push(...t):this.body.push(t),this}addFooter(t){return Array.isArray(t)?this.footers.push(...t):this.footers.push(t),this}async build(t,e={}){const s=t.addWorksheet(this.config.name,{properties:{defaultRowHeight:this.config.defaultRowHeight||20,tabColor:this.config.tabColor},pageSetup:this.config.pageSetup});let r=1;if(this.headers.length>0&&this.headers.forEach(t=>{s.addRow([t.value]),t.mergeCell&&s.mergeCells(r,1,r,this.subHeaders.length||1),t.styles&&s.getRow(r).eachCell(e=>{e.style=this.convertStyle(t.styles)}),r++}),this.subHeaders.length>0){const t=this.subHeaders.map(t=>t.value);s.addRow(t),this.subHeaders.forEach((t,e)=>{t.styles&&(s.getRow(r).getCell(e+1).style=this.convertStyle(t.styles))}),r++}for(const i of this.body)r=this.addDataRowRecursive(s,r,i);if(this.footers.length>0)for(const i of this.footers)s.addRow([i.value]),i.mergeCell&&i.mergeTo&&s.mergeCells(r,1,r,i.mergeTo),i.styles&&s.getRow(r).eachCell(t=>{t.style=this.convertStyle(i.styles)}),r++;this.isBuilt=!0}validate(){return this.headers.length||this.body.length?{success:!0,data:!0}:{success:!1,error:{type:h.VALIDATION_ERROR,message:"La hoja no tiene datos"}}}addDataRowRecursive(t,e,s,r=1){const i=t.getRow(e).getCell(r);i.value=s.value,s.styles&&(i.style=this.convertStyle(s.styles)),s.numberFormat&&(i.numFmt=s.numberFormat);let o=e;if(s.children&&s.children.length>0){let i=e;for(const e of s.children){i++;const s=this.addDataRowRecursive(t,i,e,r+1);s>o&&(o=s)}}return o}convertStyle(t){if(!t)return{};const e={};return t.font&&(e.font={name:t.font.family,size:t.font.size,bold:t.font.bold,italic:t.font.italic,underline:t.font.underline,color:t.font.color}),t.fill&&(e.fill={type:t.fill.type,pattern:t.fill.pattern,fgColor:t.fill.fgColor,bgColor:t.fill.bgColor}),t.border&&(e.border={top:t.border.top,left:t.border.left,bottom:t.border.bottom,right:t.border.right}),t.alignment&&(e.alignment={horizontal:t.alignment.horizontal,vertical:t.alignment.vertical,wrapText:t.alignment.wrapText,indent:t.alignment.indent}),t.numFmt&&(e.numFmt=t.numFmt),e}}var c=(t=>(t.WORKSHEET_ADDED="worksheetAdded",t.WORKSHEET_REMOVED="worksheetRemoved",t.WORKSHEET_UPDATED="worksheetUpdated",t.BUILD_STARTED="buildStarted",t.BUILD_PROGRESS="buildProgress",t.BUILD_COMPLETED="buildCompleted",t.BUILD_ERROR="buildError",t.DOWNLOAD_STARTED="downloadStarted",t.DOWNLOAD_PROGRESS="downloadProgress",t.DOWNLOAD_COMPLETED="downloadCompleted",t.DOWNLOAD_ERROR="downloadError",t))(c||{});class u{config;worksheets=new Map;currentWorksheet;isBuilding=!1;stats;eventEmitter;constructor(t={}){this.config={enableValidation:!0,enableEvents:!0,enablePerformanceMonitoring:!1,maxWorksheets:255,maxRowsPerWorksheet:1048576,maxColumnsPerWorksheet:16384,memoryLimit:104857600,...t},this.stats=this.initializeStats(),this.eventEmitter=new s}addWorksheet(t,e={}){if(this.worksheets.has(t))throw new Error(`Worksheet "${t}" already exists`);const s={name:t,defaultRowHeight:20,defaultColWidth:10,...this.config.defaultWorksheetConfig,...e},r=new d(s);return this.worksheets.set(t,r),this.currentWorksheet=r,this.emitEvent(c.WORKSHEET_ADDED,{worksheetName:t}),r}getWorksheet(t){return this.worksheets.get(t)}removeWorksheet(t){const e=this.worksheets.get(t);return!!e&&(this.worksheets.delete(t),this.currentWorksheet===e&&(this.currentWorksheet=void 0),this.emitEvent(c.WORKSHEET_REMOVED,{worksheetName:t}),!0)}setCurrentWorksheet(t){const e=this.worksheets.get(t);return!!e&&(this.currentWorksheet=e,!0)}async build(e={}){if(this.isBuilding)return{success:!1,error:{type:h.BUILD_ERROR,message:"Build already in progress",stack:(new Error).stack||""}};this.isBuilding=!0;const s=Date.now();try{this.emitEvent(c.BUILD_STARTED);const r=new t.Workbook;this.config.metadata&&(r.creator=this.config.metadata.author||"Han Excel Builder",r.lastModifiedBy=this.config.metadata.author||"Han Excel Builder",r.created=this.config.metadata.created||new Date,r.modified=this.config.metadata.modified||new Date,this.config.metadata.title&&(r.title=this.config.metadata.title),this.config.metadata.subject&&(r.subject=this.config.metadata.subject),this.config.metadata.keywords&&(r.keywords=this.config.metadata.keywords),this.config.metadata.category&&(r.category=this.config.metadata.category),this.config.metadata.description&&(r.description=this.config.metadata.description));for(const t of this.worksheets.values())await t.build(r,e);const i=await r.xlsx.writeBuffer({compression:e.compressionLevel||6}),o=Date.now();this.stats.buildTime=o-s,this.stats.fileSize=i.byteLength;const n={success:!0,data:i};return this.emitEvent(c.BUILD_COMPLETED,{buildTime:this.stats.buildTime,fileSize:this.stats.fileSize}),n}catch(r){const t={success:!1,error:{type:h.BUILD_ERROR,message:r instanceof Error?r.message:"Unknown build error",stack:r instanceof Error&&r.stack||""}};return this.emitEvent(c.BUILD_ERROR,{error:t.error}),t}finally{this.isBuilding=!1}}async generateAndDownload(t,s={}){const r=await this.build(s);if(!r.success)return r;try{this.emitEvent(c.DOWNLOAD_STARTED,{fileName:t});const i=new Blob([r.data],{type:s.mimeType||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return e(i,t),this.emitEvent(c.DOWNLOAD_COMPLETED,{fileName:t}),{success:!0,data:void 0}}catch(i){const t={success:!1,error:{type:h.BUILD_ERROR,message:i instanceof Error?i.message:"Download failed",stack:i instanceof Error&&i.stack||""}};return this.emitEvent(c.DOWNLOAD_ERROR,{error:t.error}),t}}async toBuffer(t={}){return this.build(t)}async toBlob(t={}){const e=await this.build(t);if(!e.success)return e;return{success:!0,data:new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}}validate(){const t=[];0===this.worksheets.size&&t.push("No worksheets found");for(const[e,s]of this.worksheets.entries()){const r=s.validate();r.success||t.push(`Worksheet "${e}": ${r.error?.message}`)}return t.length>0?{success:!1,error:{type:h.VALIDATION_ERROR,message:t.join("; "),stack:(new Error).stack||""}}:{success:!0,data:!0}}clear(){this.worksheets.clear(),this.currentWorksheet=void 0}getStats(){return{...this.stats}}on(t,e){return this.eventEmitter.on(t,e)}off(t,e){return this.eventEmitter.off(t,e)}removeAllListeners(t){t?this.eventEmitter.offAll(t):this.eventEmitter.clear()}emitEvent(t,e){const s={type:t,data:e||{},timestamp:new Date};this.eventEmitter.emitSync(s)}initializeStats(){return{totalWorksheets:0,totalCells:0,memoryUsage:0,buildTime:0,fileSize:0,stylesUsed:0,formulasUsed:0,conditionalFormatsUsed:0,performance:{headersTime:0,dataTime:0,stylesTime:0,writeTime:0}}}}class m{style={};static create(){return new m}fontName(t){return this.style.font||(this.style.font={}),this.style.font.name=t,this}fontSize(t){return this.style.font||(this.style.font={}),this.style.font.size=t,this}fontStyle(t){return this.style.font||(this.style.font={}),this.style.font.style=t,this}fontColor(t){return this.style.font||(this.style.font={}),this.style.font.color=t,this}fontBold(){return this.style.font||(this.style.font={}),this.style.font.bold=!0,this}fontItalic(){return this.style.font||(this.style.font={}),this.style.font.italic=!0,this}fontUnderline(){return this.style.font||(this.style.font={}),this.style.font.underline=!0,this}border(t,e){this.style.border||(this.style.border={});const s={style:t};return void 0!==e&&(s.color=e),this.style.border.top=s,this.style.border.left=s,this.style.border.bottom=s,this.style.border.right=s,this}borderTop(t,e){this.style.border||(this.style.border={});const s={style:t};return void 0!==e&&(s.color=e),this.style.border.top=s,this}borderLeft(t,e){this.style.border||(this.style.border={});const s={style:t};return void 0!==e&&(s.color=e),this.style.border.left=s,this}borderBottom(t,e){this.style.border||(this.style.border={});const s={style:t};return void 0!==e&&(s.color=e),this.style.border.bottom=s,this}borderRight(t,e){this.style.border||(this.style.border={});const s={style:t};return void 0!==e&&(s.color=e),this.style.border.right=s,this}backgroundColor(t){return this.style.fill||(this.style.fill={type:"pattern"}),this.style.fill.backgroundColor=t,this.style.fill.pattern="solid",this}horizontalAlign(t){return this.style.alignment||(this.style.alignment={}),this.style.alignment.horizontal=t,this}verticalAlign(t){return this.style.alignment||(this.style.alignment={}),this.style.alignment.vertical=t,this}centerAlign(){return this.style.alignment||(this.style.alignment={}),this.style.alignment.horizontal=o.CENTER,this.style.alignment.vertical=n.MIDDLE,this}leftAlign(){return this.style.alignment||(this.style.alignment={}),this.style.alignment.horizontal=o.LEFT,this}rightAlign(){return this.style.alignment||(this.style.alignment={}),this.style.alignment.horizontal=o.RIGHT,this}wrapText(){return this.style.alignment||(this.style.alignment={}),this.style.alignment.wrapText=!0,this}numberFormat(t){return this.style.numberFormat=t,this}striped(){return this.style.striped=!0,this}conditionalFormat(t){return this.style.conditionalFormats||(this.style.conditionalFormats=[]),this.style.conditionalFormats.push(t),this}build(){return this.style}reset(){return this.style={},this}clone(){const t=new m;return t.style=JSON.parse(JSON.stringify(this.style)),t}}var f=(t=>(t.CREATED="created",t.UPDATED="updated",t.DELETED="deleted",t.STYLED="styled",t.VALIDATED="validated",t))(f||{}),y=(t=>(t.CREATED="created",t.UPDATED="updated",t.DELETED="deleted",t.TABLE_ADDED="tableAdded",t.TABLE_REMOVED="tableRemoved",t.CELL_ADDED="cellAdded",t.CELL_UPDATED="cellUpdated",t.CELL_DELETED="cellDeleted",t))(y||{}),E=(t=>(t.HEADER="header",t.SUBHEADER="subheader",t.DATA="data",t.FOOTER="footer",t.TOTAL="total",t.HIGHLIGHT="highlight",t.WARNING="warning",t.ERROR="error",t.SUCCESS="success",t.INFO="info",t))(E||{});exports.BorderStyle=l,exports.BuilderEventType=c,exports.CellEventType=f,exports.CellType=r,exports.ErrorType=h,exports.EventEmitter=s,exports.ExcelBuilder=u,exports.FontStyle=a,exports.HorizontalAlignment=o,exports.NumberFormat=i,exports.StyleBuilder=m,exports.StylePreset=E,exports.VerticalAlignment=n,exports.Worksheet=d,exports.WorksheetEventType=y,exports.default=u;
//# sourceMappingURL=han-excel.cjs.js.map
