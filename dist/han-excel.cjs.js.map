{"version":3,"file":"han-excel.cjs.js","sources":["../src/utils/EventEmitter.ts","../src/types/core.types.ts","../src/core/Worksheet.ts","../src/types/builder.types.ts","../src/core/ExcelBuilder.ts","../src/styles/StyleBuilder.ts","../src/types/cell.types.ts","../src/types/worksheet.types.ts","../src/types/style.types.ts"],"sourcesContent":["/**\r\n * Simple EventEmitter implementation\r\n */\r\n\r\n/**\r\n * Event listener function type\r\n */\r\nexport type EventListener<T = any> = (event: T) => void | Promise<void>;\r\n\r\n/**\r\n * Event listener options\r\n */\r\nexport interface EventListenerOptions {\r\n  /** Whether to execute the listener only once */\r\n  once?: boolean;\r\n  /** Whether to execute the listener asynchronously */\r\n  async?: boolean;\r\n  /** Priority of the listener (higher = executed first) */\r\n  priority?: number;\r\n  /** Whether to stop event propagation */\r\n  stopPropagation?: boolean;\r\n}\r\n\r\n/**\r\n * Event listener registration\r\n */\r\nexport interface EventListenerRegistration {\r\n  /** Event type */\r\n  type: string;\r\n  /** Listener function */\r\n  listener: EventListener;\r\n  /** Listener options */\r\n  options: EventListenerOptions;\r\n  /** Registration ID */\r\n  id: string;\r\n  /** Whether the listener is active */\r\n  active: boolean;\r\n  /** Registration timestamp */\r\n  timestamp: Date;\r\n}\r\n\r\n/**\r\n * EventEmitter class for handling events\r\n */\r\nexport class EventEmitter {\r\n  private listeners: Map<string, EventListenerRegistration[]> = new Map();\r\n\r\n  /**\r\n   * Add an event listener\r\n   */\r\n  on<T = any>(type: string, listener: EventListener<T>, options: EventListenerOptions = {}): string {\r\n    if (!this.listeners.has(type)) {\r\n      this.listeners.set(type, []);\r\n    }\r\n\r\n    const registration: EventListenerRegistration = {\r\n      type,\r\n      listener: listener as EventListener,\r\n      options: {\r\n        once: false,\r\n        async: false,\r\n        priority: 0,\r\n        stopPropagation: false,\r\n        ...options\r\n      },\r\n      id: this.generateId(),\r\n      active: true,\r\n      timestamp: new Date()\r\n    };\r\n\r\n    this.listeners.get(type)!.push(registration);\r\n    \r\n    // Sort by priority (higher priority first)\r\n    this.listeners.get(type)!.sort((a, b) => (b.options.priority || 0) - (a.options.priority || 0));\r\n\r\n    return registration.id;\r\n  }\r\n\r\n  /**\r\n   * Add a one-time event listener\r\n   */\r\n  once<T = any>(type: string, listener: EventListener<T>, options: EventListenerOptions = {}): string {\r\n    return this.on(type, listener, { ...options, once: true });\r\n  }\r\n\r\n  /**\r\n   * Remove an event listener\r\n   */\r\n  off(type: string, listenerId: string): boolean {\r\n    const listeners = this.listeners.get(type);\r\n    if (!listeners) {\r\n      return false;\r\n    }\r\n\r\n    const index = listeners.findIndex(reg => reg.id === listenerId);\r\n    if (index === -1) {\r\n      return false;\r\n    }\r\n\r\n    listeners.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Remove all listeners for an event type\r\n   */\r\n  offAll(type: string): number {\r\n    const listeners = this.listeners.get(type);\r\n    if (!listeners) {\r\n      return 0;\r\n    }\r\n\r\n    const count = listeners.length;\r\n    this.listeners.delete(type);\r\n    return count;\r\n  }\r\n\r\n  /**\r\n   * Emit an event\r\n   */\r\n  async emit<T = any>(event: T): Promise<void> {\r\n    const type = (event as any).type || 'default';\r\n    const listeners = this.listeners.get(type);\r\n    \r\n    if (!listeners || listeners.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const activeListeners = listeners.filter(reg => reg.active);\r\n    \r\n    for (const registration of activeListeners) {\r\n      try {\r\n        if (registration.options.once) {\r\n          registration.active = false;\r\n        }\r\n\r\n        if (registration.options.async) {\r\n          await registration.listener(event);\r\n        } else {\r\n          registration.listener(event);\r\n        }\r\n\r\n        if (registration.options.stopPropagation) {\r\n          break;\r\n        }\r\n      } catch (error) {\r\n        console.error(`Error in event listener for ${type}:`, error);\r\n      }\r\n    }\r\n\r\n    // Clean up inactive listeners\r\n    this.cleanupInactiveListeners(type);\r\n  }\r\n\r\n  /**\r\n   * Emit an event synchronously\r\n   */\r\n  emitSync<T = any>(event: T): void {\r\n    const type = (event as any).type || 'default';\r\n    const listeners = this.listeners.get(type);\r\n    \r\n    if (!listeners || listeners.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const activeListeners = listeners.filter(reg => reg.active);\r\n    \r\n    for (const registration of activeListeners) {\r\n      try {\r\n        if (registration.options.once) {\r\n          registration.active = false;\r\n        }\r\n\r\n        registration.listener(event);\r\n\r\n        if (registration.options.stopPropagation) {\r\n          break;\r\n        }\r\n      } catch (error) {\r\n        console.error(`Error in event listener for ${type}:`, error);\r\n      }\r\n    }\r\n\r\n    // Clean up inactive listeners\r\n    this.cleanupInactiveListeners(type);\r\n  }\r\n\r\n  /**\r\n   * Clear all listeners\r\n   */\r\n  clear(): void {\r\n    this.listeners.clear();\r\n  }\r\n\r\n  /**\r\n   * Get listeners for an event type\r\n   */\r\n  getListeners(type: string): EventListenerRegistration[] {\r\n    return this.listeners.get(type) || [];\r\n  }\r\n\r\n  /**\r\n   * Get listener count for an event type\r\n   */\r\n  getListenerCount(type: string): number {\r\n    return this.listeners.get(type)?.length || 0;\r\n  }\r\n\r\n  /**\r\n   * Get all registered event types\r\n   */\r\n  getEventTypes(): string[] {\r\n    return Array.from(this.listeners.keys());\r\n  }\r\n\r\n  // Private methods\r\n\r\n  private generateId(): string {\r\n    return Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  private cleanupInactiveListeners(type: string): void {\r\n    const listeners = this.listeners.get(type);\r\n    if (listeners) {\r\n      const activeListeners = listeners.filter(reg => reg.active);\r\n      if (activeListeners.length !== listeners.length) {\r\n        this.listeners.set(type, activeListeners);\r\n      }\r\n    }\r\n  }\r\n} ","/**\r\n * Core type definitions for Han Excel Builder\r\n */\r\n\r\nimport { CellValue } from 'exceljs';\r\n\r\n/**\r\n * Supported cell data types\r\n */\r\nexport enum CellType {\r\n  STRING = 'string',\r\n  NUMBER = 'number',\r\n  BOOLEAN = 'boolean',\r\n  DATE = 'date',\r\n  PERCENTAGE = 'percentage',\r\n  CURRENCY = 'currency',\r\n  LINK = 'link',\r\n  FORMULA = 'formula'\r\n}\r\n\r\n/**\r\n * Number format options\r\n */\r\nexport enum NumberFormat {\r\n  GENERAL = 'General',\r\n  NUMBER = '#,##0',\r\n  NUMBER_DECIMALS = '#,##0.00',\r\n  CURRENCY = '$#,##0.00',\r\n  CURRENCY_INTEGER = '$#,##0',\r\n  PERCENTAGE = '0%',\r\n  PERCENTAGE_DECIMALS = '0.00%',\r\n  DATE = 'dd/mm/yyyy',\r\n  DATE_TIME = 'dd/mm/yyyy hh:mm',\r\n  TIME = 'hh:mm:ss',\r\n  CUSTOM = 'custom'\r\n}\r\n\r\n/**\r\n * Horizontal alignment options\r\n */\r\nexport enum HorizontalAlignment {\r\n  LEFT = 'left',\r\n  CENTER = 'center',\r\n  RIGHT = 'right',\r\n  FILL = 'fill',\r\n  JUSTIFY = 'justify',\r\n  CENTER_CONTINUOUS = 'centerContinuous',\r\n  DISTRIBUTED = 'distributed'\r\n}\r\n\r\n/**\r\n * Vertical alignment options\r\n */\r\nexport enum VerticalAlignment {\r\n  TOP = 'top',\r\n  MIDDLE = 'middle',\r\n  BOTTOM = 'bottom',\r\n  DISTRIBUTED = 'distributed',\r\n  JUSTIFY = 'justify'\r\n}\r\n\r\n/**\r\n * Border style options\r\n */\r\nexport enum BorderStyle {\r\n  THIN = 'thin',\r\n  MEDIUM = 'medium',\r\n  THICK = 'thick',\r\n  DOTTED = 'dotted',\r\n  DASHED = 'dashed',\r\n  DOUBLE = 'double',\r\n  HAIR = 'hair',\r\n  MEDIUM_DASHED = 'mediumDashed',\r\n  DASH_DOT = 'dashDot',\r\n  MEDIUM_DASH_DOT = 'mediumDashDot',\r\n  DASH_DOT_DOT = 'dashDotDot',\r\n  MEDIUM_DASH_DOT_DOT = 'mediumDashDotDot',\r\n  SLANT_DASH_DOT = 'slantDashDot'\r\n}\r\n\r\n/**\r\n * Font style options\r\n */\r\nexport enum FontStyle {\r\n  NORMAL = 'normal',\r\n  BOLD = 'bold',\r\n  ITALIC = 'italic',\r\n  BOLD_ITALIC = 'bold italic'\r\n}\r\n\r\n/**\r\n * Color type - can be hex string, RGB object, or theme color\r\n */\r\nexport type Color = string | { r: number; g: number; b: number } | { theme: number };\r\n\r\n/**\r\n * Base cell properties interface\r\n */\r\nexport interface IBaseCell {\r\n  /** Unique identifier for the cell */\r\n  key: string;\r\n  /** Cell data type */\r\n  type: CellType;\r\n  /** Cell value */\r\n  value: CellValue;\r\n  /** Optional cell reference (e.g., A1, B2) */\r\n  reference?: string;\r\n  /** Whether to merge this cell with others */\r\n  mergeCell?: boolean;\r\n  /** Number of columns to merge (if mergeCell is true) */\r\n  mergeTo?: number;\r\n  /** Row height for this cell */\r\n  rowHeight?: number;\r\n  /** Column width for this cell */\r\n  colWidth?: number;\r\n  /** Whether to move to next row after this cell */\r\n  jump?: boolean;\r\n  /** Hyperlink URL */\r\n  link?: string;\r\n  /** Excel formula */\r\n  formula?: string;\r\n  /** Number format for numeric cells */\r\n  numberFormat?: NumberFormat | string;\r\n  /** Custom number format string */\r\n  customNumberFormat?: string;\r\n  /** Whether the cell is protected */\r\n  protected?: boolean;\r\n  /** Whether the cell is hidden */\r\n  hidden?: boolean;\r\n  /** Cell comment */\r\n  comment?: string;\r\n  /** Data validation rules */\r\n  validation?: IDataValidation;\r\n  /** Optional styles for the cell */\r\n  styles?: import('./style.types').IStyle;\r\n  /** Legacy children cells */\r\n  childrens?: IBaseCell[];\r\n  /** Modern children cells */\r\n  children?: IBaseCell[];\r\n}\r\n\r\n/**\r\n * Data validation interface\r\n */\r\nexport interface IDataValidation {\r\n  /** Validation type */\r\n  type: 'list' | 'whole' | 'decimal' | 'textLength' | 'date' | 'time' | 'custom';\r\n  /** Validation operator */\r\n  operator?: 'between' | 'notBetween' | 'equal' | 'notEqual' | 'greaterThan' | 'lessThan' | 'greaterThanOrEqual' | 'lessThanOrEqual';\r\n  /** Validation formula or values */\r\n  formula1?: string | number | Date;\r\n  /** Second validation formula or value (for between/notBetween) */\r\n  formula2?: string | number | Date;\r\n  /** Whether to show error message */\r\n  showErrorMessage?: boolean;\r\n  /** Error message text */\r\n  errorMessage?: string;\r\n  /** Whether to show input message */\r\n  showInputMessage?: boolean;\r\n  /** Input message text */\r\n  inputMessage?: string;\r\n  /** Whether to allow blank values */\r\n  allowBlank?: boolean;\r\n}\r\n\r\n/**\r\n * Workbook metadata interface\r\n */\r\nexport interface IWorkbookMetadata {\r\n  /** Workbook author */\r\n  author?: string;\r\n  /** Workbook title */\r\n  title?: string;\r\n  /** Workbook subject */\r\n  subject?: string;\r\n  /** Workbook keywords */\r\n  keywords?: string;\r\n  /** Workbook category */\r\n  category?: string;\r\n  /** Workbook description */\r\n  description?: string;\r\n  /** Workbook company */\r\n  company?: string;\r\n  /** Workbook manager */\r\n  manager?: string;\r\n  /** Creation date */\r\n  created?: Date;\r\n  /** Last modified date */\r\n  modified?: Date;\r\n  /** Application name */\r\n  application?: string;\r\n  /** Application version */\r\n  appVersion?: string;\r\n  /** Hyperlink base */\r\n  hyperlinkBase?: string;\r\n}\r\n\r\n/**\r\n * Error types for validation\r\n */\r\nexport enum ErrorType {\r\n  VALIDATION_ERROR = 'VALIDATION_ERROR',\r\n  BUILD_ERROR = 'BUILD_ERROR',\r\n  STYLE_ERROR = 'STYLE_ERROR',\r\n  WORKSHEET_ERROR = 'WORKSHEET_ERROR',\r\n  CELL_ERROR = 'CELL_ERROR'\r\n}\r\n\r\n/**\r\n * Error interface\r\n */\r\nexport interface IError {\r\n  type: ErrorType;\r\n  message: string;\r\n  code?: string;\r\n  details?: Record<string, unknown>;\r\n  stack?: string;\r\n}\r\n\r\n/**\r\n * Success result interface\r\n */\r\nexport interface ISuccessResult<T = unknown> {\r\n  success: true;\r\n  data: T;\r\n  message?: string;\r\n}\r\n\r\n/**\r\n * Error result interface\r\n */\r\nexport interface IErrorResult {\r\n  success: false;\r\n  error: IError;\r\n}\r\n\r\n/**\r\n * Result union type\r\n */\r\nexport type Result<T = unknown> = ISuccessResult<T> | IErrorResult; ","import ExcelJS from 'exceljs';\r\nimport {\r\n  IWorksheet,\r\n  IWorksheetConfig,\r\n  ITable\r\n} from '../types/worksheet.types';\r\nimport {\r\n  IDataCell,\r\n  IHeaderCell,\r\n  IFooterCell\r\n} from '../types/cell.types';\r\nimport { IBuildOptions } from '../types/builder.types';\r\nimport { Result, ErrorType } from '../types/core.types';\r\n\r\n/**\r\n * Worksheet - Representa una hoja de cálculo dentro del builder\r\n *\r\n2 * Soporta headers, subheaders anidados, rows, footers, children y estilos por celda.\r\n */\r\nexport class Worksheet implements IWorksheet {\r\n  public config: IWorksheetConfig;\r\n  public tables: ITable[] = [];\r\n  public currentRow = 1;\r\n  public currentCol = 1;\r\n  public headerPointers: Map<string, any> = new Map();\r\n  public isBuilt = false;\r\n\r\n  // Estructuras temporales para la tabla actual\r\n  private headers: IHeaderCell[] = [];\r\n  private subHeaders: IHeaderCell[] = [];\r\n  private body: IDataCell[] = [];\r\n  private footers: IFooterCell[] = [];\r\n\r\n  constructor(config: IWorksheetConfig) {\r\n    this.config = config;\r\n  }\r\n\r\n  /**\r\n   * Agrega un header principal\r\n   */\r\n  addHeader(header: IHeaderCell): this {\r\n    this.headers.push(header);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Agrega subheaders (ahora soporta anidación)\r\n   */\r\n  addSubHeaders(subHeaders: IHeaderCell[]): this {\r\n    this.subHeaders.push(...subHeaders);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Agrega una fila de datos (puede ser jerárquica con childrens)\r\n   */\r\n  addRow(row: IDataCell[] | IDataCell): this {\r\n    if (Array.isArray(row)) {\r\n      this.body.push(...row);\r\n    } else {\r\n      this.body.push(row);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Agrega un footer o varios\r\n   */\r\n  addFooter(footer: IFooterCell[] | IFooterCell): this {\r\n    if (Array.isArray(footer)) {\r\n      this.footers.push(...footer);\r\n    } else {\r\n      this.footers.push(footer);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Construye la hoja en el workbook de ExcelJS\r\n   */\r\n  async build(workbook: ExcelJS.Workbook, _options: IBuildOptions = {}): Promise<void> {\r\n    const ws = workbook.addWorksheet(this.config.name, {\r\n      properties: {\r\n        defaultRowHeight: this.config.defaultRowHeight || 20,\r\n        tabColor: this.config.tabColor as any\r\n      },\r\n      pageSetup: this.config.pageSetup as any\r\n    });\r\n\r\n    let rowPointer = 1;\r\n    \r\n    // Headers principales\r\n    if (this.headers.length > 0) {\r\n      this.headers.forEach(header => {\r\n        ws.addRow([header.value]);\r\n        if (header.mergeCell) {\r\n          ws.mergeCells(rowPointer, 1, rowPointer, (this.getMaxColumns() || 1));\r\n        }\r\n        if (header.styles) {\r\n          ws.getRow(rowPointer).eachCell(cell => {\r\n            cell.style = this.convertStyle(header.styles);\r\n          });\r\n        }\r\n        rowPointer++;\r\n      });\r\n    }\r\n    \r\n    // SubHeaders con soporte para anidación\r\n    if (this.subHeaders.length > 0) {\r\n      rowPointer = this.buildNestedHeaders(ws, rowPointer, this.subHeaders);\r\n    }\r\n    \r\n    // Body (soporta children)\r\n    for (const row of this.body) {\r\n      rowPointer = this.addDataRowRecursive(ws, rowPointer, row);\r\n    }\r\n    \r\n    // Footers\r\n    if (this.footers.length > 0) {\r\n      for (const footer of this.footers) {\r\n        rowPointer = this.addFooterRow(ws, rowPointer, footer);\r\n      }\r\n    }\r\n    \r\n    this.isBuilt = true;\r\n  }\r\n\r\n  /**\r\n   * Construye headers anidados recursivamente\r\n   * @param ws - Worksheet de ExcelJS\r\n   * @param startRow - Fila inicial\r\n   * @param headers - Array de headers a procesar\r\n   * @returns La siguiente fila disponible\r\n   */\r\n    private buildNestedHeaders(ws: ExcelJS.Worksheet, startRow: number, headers: IHeaderCell[]): number {\r\n    let currentRow = startRow;\r\n    const maxDepth = this.getMaxHeaderDepth(headers);\r\n    \r\n    // Crear filas para cada nivel de profundidad\r\n    for (let depth = 0; depth < maxDepth; depth++) {\r\n      // Crear la fila primero\r\n      const row = ws.getRow(currentRow);\r\n      \r\n      // Procesar cada header en este nivel\r\n      let colIndex = 1;\r\n      for (const header of headers) {\r\n        if (depth === 0) {\r\n          // Nivel principal del header\r\n          const headerInfo = this.getHeaderAtDepth(header, depth, colIndex);\r\n          const cell = row.getCell(colIndex);\r\n          cell.value = headerInfo.value;\r\n          if (headerInfo.style) {\r\n            cell.style = this.convertStyle(headerInfo.style);\r\n          }\r\n          colIndex += headerInfo.colSpan;\r\n        } else {\r\n          // Nivel de children - procesar todos los children directos\r\n          if (header.children && header.children.length > 0) {\r\n            for (const child of header.children) {\r\n              const cell = row.getCell(colIndex);\r\n              cell.value = typeof child.value === 'string' ? child.value : String(child.value || '');\r\n              if (child.styles || header.styles) {\r\n                cell.style = this.convertStyle(child.styles || header.styles);\r\n              }\r\n              colIndex += this.calculateHeaderColSpan(child);\r\n            }\r\n          } else {\r\n            // Si no tiene children, agregar celda vacía\r\n            const cell = row.getCell(colIndex);\r\n            cell.value = null;\r\n            colIndex += 1;\r\n          }\r\n        }\r\n      }\r\n      \r\n      currentRow++;\r\n    }\r\n    \r\n    // Aplicar todos los merges después de crear todas las filas\r\n    this.applyAllMerges(ws, startRow, currentRow - 1, headers);\r\n    \r\n    return currentRow;\r\n  }\r\n\r\n  /**\r\n   * Obtiene información del header en una profundidad específica\r\n   */\r\n  private getHeaderAtDepth(header: IHeaderCell, depth: number, startCol: number): {\r\n    value: string | null;\r\n    style: any;\r\n    colSpan: number;\r\n    mergeRange?: { start: number; end: number } | null;\r\n  } {\r\n    const colSpan = this.calculateHeaderColSpan(header);\r\n    if (depth === 0) {\r\n      // Nivel principal del header\r\n      console.log(' paso dios mio header', header.value);\r\n      const mergeRange = colSpan > 1 ? { start: startCol, end: startCol + colSpan - 1 } : null;\r\n      return {\r\n        value: typeof header.value === 'string' ? header.value : String(header.value || ''),\r\n        style: header.styles,\r\n        colSpan,\r\n        mergeRange: mergeRange\r\n      };\r\n    } else if (header.children && header.children.length > 0) {\r\n      // Nivel de children\r\n      const child = header.children[depth];\r\n      if (child) {\r\n        const childColSpan = this.calculateHeaderColSpan(child);\r\n        // Los children también pueden hacer merge si tienen múltiples childrens\r\n        const mergeRange = childColSpan > 1 ? { start: startCol, end: startCol + childColSpan - 1 } : null;\r\n        \r\n        return {\r\n          value: typeof child.value === 'string' ? child.value : String(child.value || ''),\r\n          style: child.styles || header.styles,\r\n          colSpan: childColSpan,\r\n          mergeRange: mergeRange\r\n        };\r\n      }\r\n    }\r\n    \r\n    // Celda vacía para mantener alineación\r\n    return {\r\n      value: null,\r\n      style: null,\r\n      colSpan: 1\r\n    };\r\n  }\r\n\r\n\r\n\r\n\r\n  /**\r\n   * Aplica todos los merges (horizontales y verticales) después de crear todas las filas\r\n   */\r\n  private applyAllMerges(ws: ExcelJS.Worksheet, startRow: number, endRow: number, headers: IHeaderCell[]): void {\r\n    const maxDepth = this.getMaxHeaderDepth(headers);\r\n    \r\n    // Solo aplicar merges si hay más de una fila de headers\r\n    if (maxDepth <= 1) return;\r\n    \r\n    // Aplicar merges inteligentes basados en la estructura\r\n    this.applySmartMerges(ws, startRow, endRow, headers);\r\n  }\r\n\r\n  /**\r\n   * Aplica merges inteligentes basados en la estructura de headers\r\n   */\r\n  private applySmartMerges(ws: ExcelJS.Worksheet, startRow: number, endRow: number, headers: IHeaderCell[]): void {\r\n    const maxDepth = this.getMaxHeaderDepth(headers);\r\n    \r\n    // Solo aplicar merges si hay más de una fila de headers\r\n    if (maxDepth <= 1) return;\r\n    \r\n    // Aplicar merges para cada header\r\n    let colIndex = 1;\r\n    for (const header of headers) {\r\n      this.applySmartMergesForHeader(ws, startRow, endRow, header, colIndex);\r\n      colIndex += this.calculateHeaderColSpan(header);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Aplica merges inteligentes para un header específico\r\n   */\r\n  private applySmartMergesForHeader(ws: ExcelJS.Worksheet, startRow: number, endRow: number, header: IHeaderCell, startCol: number): void {\r\n    const headerColSpan = this.calculateHeaderColSpan(header);\r\n    \r\n    if (!header.children || header.children.length === 0) {\r\n      // Si no tiene children, hacer merge vertical desde la primera fila hasta la última\r\n      ws.mergeCells(startRow, startCol, endRow, startCol + headerColSpan - 1);\r\n    } else {\r\n      // Si tiene children, aplicar merge horizontal en la primera fila\r\n      if (headerColSpan > 1) {\r\n        ws.mergeCells(startRow, startCol, startRow, startCol + headerColSpan - 1);\r\n      }\r\n      \r\n      // Procesar children recursivamente\r\n      let childColIndex = startCol;\r\n      for (const child of header.children) {\r\n        this.applySmartMergesForHeader(ws, startRow + 1, endRow, child, childColIndex);\r\n        childColIndex += this.calculateHeaderColSpan(child);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n \r\n  /**\r\n   * Calcula el span de columnas para un header\r\n   */\r\n  private calculateHeaderColSpan(header: IHeaderCell): number {\r\n    if (!header.children || header.children.length === 0) {\r\n      return 1;\r\n    }\r\n    \r\n    return header.children.reduce((total, child) => {\r\n      return total + this.calculateHeaderColSpan(child);\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Obtiene la profundidad máxima de headers anidados\r\n   */\r\n  private getMaxHeaderDepth(headers: IHeaderCell[]): number {\r\n    let maxDepth = 1;\r\n    \r\n    for (const header of headers) {\r\n      if (header.children && header.children.length > 0) {\r\n        const childDepth = this.getMaxHeaderDepth(header.children);\r\n        maxDepth = Math.max(maxDepth, childDepth + 1);\r\n      }\r\n    }\r\n    \r\n    return maxDepth;\r\n  }\r\n\r\n  /**\r\n   * Obtiene el número máximo de columnas\r\n   */\r\n  private getMaxColumns(): number {\r\n    let maxCols = 0;\r\n    \r\n    for (const header of this.subHeaders) {\r\n      maxCols += this.calculateHeaderColSpan(header);\r\n    }\r\n    \r\n    return maxCols;\r\n  }\r\n\r\n  /**\r\n   * Valida la hoja\r\n   */\r\n  validate(): Result<boolean> {\r\n    if (!this.headers.length && !this.body.length) {\r\n      return {\r\n        success: false,\r\n        error: {\r\n          type: ErrorType.VALIDATION_ERROR,\r\n          message: 'La hoja no tiene datos',\r\n        }\r\n      };\r\n    }\r\n    return { success: true, data: true };\r\n  }\r\n\r\n  /**\r\n   * Calcula las posiciones de columnas para los datos basándose en la estructura de subheaders\r\n   */\r\n  private calculateDataColumnPositions(): { [key: string]: number } {\r\n    const positions: { [key: string]: number } = {};\r\n    let currentCol = 1;\r\n    \r\n    for (const header of this.subHeaders) {\r\n      if (header.children && header.children.length > 0) {\r\n        // Si el header tiene children, cada child ocupa una columna\r\n        for (const child of header.children) {\r\n          if (child.key) {\r\n            positions[child.key] = currentCol;\r\n          }\r\n          if (child.value) {\r\n            positions[String(child.value)] = currentCol;\r\n          }\r\n          currentCol++;\r\n        }\r\n      } else {\r\n        // Si el header no tiene children, ocupa una columna\r\n        if (header.key) {\r\n          positions[header.key] = currentCol;\r\n        }\r\n        if (header.value) {\r\n          positions[String(header.value)] = currentCol;\r\n        }\r\n        currentCol++;\r\n      }\r\n    }\r\n    \r\n    return positions;\r\n  }\r\n\r\n  /**\r\n   * Agrega una fila de footer\r\n   * @returns el siguiente rowPointer disponible\r\n   */\r\n  private addFooterRow(ws: ExcelJS.Worksheet, rowPointer: number, footer: IFooterCell): number {\r\n    // Calcular las columnas basándose en la estructura de subheaders\r\n    const columnPositions = this.calculateDataColumnPositions();\r\n    \r\n    // Buscar la columna correcta para el footer\r\n    let footerColPosition: number | undefined;\r\n    \r\n    // Intentar encontrar por key primero\r\n    if (footer.key && columnPositions[footer.key]) {\r\n      footerColPosition = columnPositions[footer.key];\r\n    }\r\n    // Si no se encuentra por key, intentar por header\r\n    else if (footer.header && columnPositions[footer.header]) {\r\n      footerColPosition = columnPositions[footer.header];\r\n    }\r\n    \r\n    // Si no se encuentra la posición, usar columna 1 por defecto\r\n    if (footerColPosition === undefined) {\r\n      footerColPosition = 1;\r\n    }\r\n    \r\n    // Escribir el footer en la columna correcta\r\n    const excelRow = ws.getRow(rowPointer);\r\n    const footerCell = excelRow.getCell(footerColPosition);\r\n    footerCell.value = footer.value;\r\n    if (footer.styles) {\r\n      footerCell.style = this.convertStyle(footer.styles);\r\n    }\r\n    if (footer.numberFormat) {\r\n      footerCell.numFmt = footer.numberFormat;\r\n    }\r\n    \r\n    // Aplicar merge si está configurado\r\n    if (footer.mergeCell && footer.mergeTo) {\r\n      ws.mergeCells(rowPointer, footerColPosition, rowPointer, footer.mergeTo);\r\n    }\r\n    \r\n    // Si hay children, escribirlos en las columnas correspondientes\r\n    if (footer.children && footer.children.length > 0) {\r\n      for (const child of footer.children) {\r\n        if (child) {\r\n          // Buscar la columna correcta basándose en el header del child\r\n          let colPosition: number | undefined;\r\n          \r\n          // Intentar encontrar por key primero\r\n          if (child.key && columnPositions[child.key]) {\r\n            colPosition = columnPositions[child.key];\r\n          }\r\n          // Si no se encuentra por key, intentar por header\r\n          else if (child.header && columnPositions[child.header]) {\r\n            colPosition = columnPositions[child.header];\r\n          }\r\n          \r\n          if (colPosition !== undefined) {\r\n            const childCell = excelRow.getCell(colPosition);\r\n            childCell.value = child.value;\r\n            if (child.styles) {\r\n              childCell.style = this.convertStyle(child.styles);\r\n            }\r\n            if (child.numberFormat) {\r\n              childCell.numFmt = child.numberFormat;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Incrementar rowPointer solo si el footer tiene la propiedad jump\r\n    if (footer.jump) {\r\n      return rowPointer + 1;\r\n    }\r\n    \r\n    return rowPointer;\r\n  }\r\n\r\n  /**\r\n   * Agrega una fila de datos y sus children recursivamente\r\n   * @returns el siguiente rowPointer disponible\r\n   */\r\n  private addDataRowRecursive(ws: ExcelJS.Worksheet, rowPointer: number, row: IDataCell): number {\r\n    // Calcular las columnas basándose en la estructura de subheaders\r\n    const columnPositions = this.calculateDataColumnPositions();\r\n    console.log('columnPositions', columnPositions);\r\n\r\n    // Buscar la columna correcta para el dato principal\r\n    let mainColPosition: number | undefined;\r\n    \r\n    // Intentar encontrar por key primero\r\n    if (row.key && columnPositions[row.key]) {\r\n      mainColPosition = columnPositions[row.key];\r\n    }\r\n    // Si no se encuentra por key, intentar por header\r\n    else if (row.header && columnPositions[row.header]) {\r\n      mainColPosition = columnPositions[row.header];\r\n    }\r\n    \r\n    // Si no se encuentra la posición, usar columna 1 por defecto\r\n    if (mainColPosition === undefined) {\r\n      mainColPosition = 1;\r\n    }\r\n    \r\n    // Escribir el dato principal en la columna correcta\r\n    const excelRow = ws.getRow(rowPointer);\r\n    const mainCell = excelRow.getCell(mainColPosition);\r\n    mainCell.value = row.value;\r\n    if (row.styles) {\r\n      mainCell.style = this.convertStyle(row.styles);\r\n    }\r\n    if (row.numberFormat) {\r\n      mainCell.numFmt = row.numberFormat;\r\n    }\r\n    \r\n    // Si hay children, escribirlos en las columnas correspondientes\r\n    if (row.children && row.children.length > 0) {\r\n      for (const child of row.children) {\r\n        if (child) {\r\n          // Buscar la columna correcta basándose en el header del child\r\n          let colPosition: number | undefined;\r\n          \r\n          // Intentar encontrar por key primero\r\n          if (child.key && columnPositions[child.key]) {\r\n            colPosition = columnPositions[child.key];\r\n          }\r\n          // Si no se encuentra por key, intentar por header\r\n          else if (child.header && columnPositions[child.header]) {\r\n            colPosition = columnPositions[child.header];\r\n          }\r\n          \r\n          if (colPosition !== undefined) {\r\n            const childCell = excelRow.getCell(colPosition);\r\n            childCell.value = child.value;\r\n            if (child.styles) {\r\n              childCell.style = this.convertStyle(child.styles);\r\n            }\r\n            if (child.numberFormat) {\r\n              childCell.numFmt = child.numberFormat;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Incrementar rowPointer solo si la celda tiene la propiedad jump\r\n    if (row.jump) {\r\n      return rowPointer + 1;\r\n    }\r\n    \r\n    return rowPointer;\r\n  }\r\n\r\n  /**\r\n   * Convierte el estilo personalizado a formato compatible con ExcelJS\r\n   */\r\n  private convertStyle(style: any): Partial<ExcelJS.Style> {\r\n    if (!style) return {};\r\n    \r\n    const converted: Partial<ExcelJS.Style> = {};\r\n    \r\n    if (style.font) {\r\n      converted.font = {\r\n        name: style.font.family,\r\n        size: style.font.size,\r\n        bold: style.font.bold,\r\n        italic: style.font.italic,\r\n        underline: style.font.underline,\r\n        color: style.font.color\r\n      };\r\n    }\r\n    \r\n    if (style.fill) {\r\n      converted.fill = {\r\n        type: style.fill.type,\r\n        pattern: style.fill.pattern,\r\n        fgColor: style.fill.foregroundColor,\r\n        bgColor: style.fill.backgroundColor\r\n      };\r\n    }\r\n    \r\n    if (style.border) {\r\n      converted.border = {\r\n        top: style.border.top,\r\n        left: style.border.left,\r\n        bottom: style.border.bottom,\r\n        right: style.border.right\r\n      };\r\n    }\r\n    \r\n    if (style.alignment) {\r\n      converted.alignment = {\r\n        horizontal: style.alignment.horizontal,\r\n        vertical: style.alignment.vertical,\r\n        wrapText: style.alignment.wrapText,\r\n        indent: style.alignment.indent\r\n      };\r\n    }\r\n    \r\n    if (style.numFmt) {\r\n      converted.numFmt = style.numFmt;\r\n    }\r\n    \r\n    return converted;\r\n  }\r\n}","/**\r\n * Builder-specific type definitions\r\n */\r\n\r\nimport { IWorkbookMetadata, Result } from './core.types';\r\nimport { IWorksheet, IWorksheetConfig } from './worksheet.types';\r\nimport { IStyle } from './style.types';\r\n\r\n// Re-export ErrorType for convenience\r\nexport { ErrorType } from './core.types';\r\n\r\n/**\r\n * Excel builder configuration interface\r\n */\r\nexport interface IExcelBuilderConfig {\r\n  /** Workbook metadata */\r\n  metadata?: IWorkbookMetadata;\r\n  /** Default worksheet configuration */\r\n  defaultWorksheetConfig?: Partial<IWorksheetConfig>;\r\n  /** Default styles */\r\n  defaultStyles?: {\r\n    header?: IStyle;\r\n    subheader?: IStyle;\r\n    data?: IStyle;\r\n    footer?: IStyle;\r\n    total?: IStyle;\r\n  };\r\n  /** Whether to enable validation */\r\n  enableValidation?: boolean;\r\n  /** Whether to enable events */\r\n  enableEvents?: boolean;\r\n  /** Whether to enable performance monitoring */\r\n  enablePerformanceMonitoring?: boolean;\r\n  /** Maximum number of worksheets */\r\n  maxWorksheets?: number;\r\n  /** Maximum number of rows per worksheet */\r\n  maxRowsPerWorksheet?: number;\r\n  /** Maximum number of columns per worksheet */\r\n  maxColumnsPerWorksheet?: number;\r\n  /** Memory limit in bytes */\r\n  memoryLimit?: number;\r\n}\r\n\r\n/**\r\n * Build options interface\r\n */\r\nexport interface IBuildOptions {\r\n  /** Output format */\r\n  format?: 'xlsx' | 'xls' | 'csv';\r\n  /** Whether to include styles */\r\n  includeStyles?: boolean;\r\n  /** Whether to include formulas */\r\n  includeFormulas?: boolean;\r\n  /** Whether to include comments */\r\n  includeComments?: boolean;\r\n  /** Whether to include data validation */\r\n  includeValidation?: boolean;\r\n  /** Whether to include conditional formatting */\r\n  includeConditionalFormatting?: boolean;\r\n  /** Compression level (0-9) */\r\n  compressionLevel?: number;\r\n  /** Whether to optimize for size */\r\n  optimizeForSize?: boolean;\r\n  /** Whether to optimize for speed */\r\n  optimizeForSpeed?: boolean;\r\n}\r\n\r\n/**\r\n * Download options interface\r\n */\r\nexport interface IDownloadOptions extends IBuildOptions {\r\n  /** File name */\r\n  fileName?: string;\r\n  /** Whether to show download progress */\r\n  showProgress?: boolean;\r\n  /** Progress callback */\r\n  onProgress?: (progress: number) => void;\r\n  /** Whether to auto-download */\r\n  autoDownload?: boolean;\r\n  /** MIME type */\r\n  mimeType?: string;\r\n}\r\n\r\n/**\r\n * Excel builder interface\r\n */\r\nexport interface IExcelBuilder {\r\n  /** Builder configuration */\r\n  config: IExcelBuilderConfig;\r\n  /** Worksheets in the workbook */\r\n  worksheets: Map<string, IWorksheet>;\r\n  /** Current worksheet */\r\n  currentWorksheet: IWorksheet | undefined;\r\n  /** Whether the builder is building */\r\n  isBuilding: boolean;\r\n  /** Build statistics */\r\n  stats: IBuildStats;\r\n\r\n  /** Add a new worksheet */\r\n  addWorksheet(name: string, config?: Partial<IWorksheetConfig>): IWorksheet;\r\n  /** Get a worksheet by name */\r\n  getWorksheet(name: string): IWorksheet | undefined;\r\n  /** Remove a worksheet */\r\n  removeWorksheet(name: string): boolean;\r\n  /** Set the current worksheet */\r\n  setCurrentWorksheet(name: string): boolean;\r\n  /** Build the workbook */\r\n  build(options?: IBuildOptions): Promise<Result<ArrayBuffer>>;\r\n  /** Generate and download the file */\r\n  generateAndDownload(fileName: string, options?: IDownloadOptions): Promise<Result<void>>;\r\n  /** Get workbook as buffer */\r\n  toBuffer(options?: IBuildOptions): Promise<Result<ArrayBuffer>>;\r\n  /** Get workbook as blob */\r\n  toBlob(options?: IBuildOptions): Promise<Result<Blob>>;\r\n  /** Validate the workbook */\r\n  validate(): Result<boolean>;\r\n  /** Clear all worksheets */\r\n  clear(): void;\r\n  /** Get workbook statistics */\r\n  getStats(): IBuildStats;\r\n}\r\n\r\n/**\r\n * Build statistics interface\r\n */\r\nexport interface IBuildStats {\r\n  /** Total number of worksheets */\r\n  totalWorksheets: number;\r\n  /** Total number of cells */\r\n  totalCells: number;\r\n  /** Total memory usage in bytes */\r\n  memoryUsage: number;\r\n  /** Build time in milliseconds */\r\n  buildTime: number;\r\n  /** File size in bytes */\r\n  fileSize: number;\r\n  /** Number of styles used */\r\n  stylesUsed: number;\r\n  /** Number of formulas used */\r\n  formulasUsed: number;\r\n  /** Number of conditional formats used */\r\n  conditionalFormatsUsed: number;\r\n  /** Performance metrics */\r\n  performance: {\r\n    /** Time spent building headers */\r\n    headersTime: number;\r\n    /** Time spent building data */\r\n    dataTime: number;\r\n    /** Time spent applying styles */\r\n    stylesTime: number;\r\n    /** Time spent writing to buffer */\r\n    writeTime: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Builder event types\r\n */\r\nexport enum BuilderEventType {\r\n  WORKSHEET_ADDED = 'worksheetAdded',\r\n  WORKSHEET_REMOVED = 'worksheetRemoved',\r\n  WORKSHEET_UPDATED = 'worksheetUpdated',\r\n  BUILD_STARTED = 'buildStarted',\r\n  BUILD_PROGRESS = 'buildProgress',\r\n  BUILD_COMPLETED = 'buildCompleted',\r\n  BUILD_ERROR = 'buildError',\r\n  DOWNLOAD_STARTED = 'downloadStarted',\r\n  DOWNLOAD_PROGRESS = 'downloadProgress',\r\n  DOWNLOAD_COMPLETED = 'downloadCompleted',\r\n  DOWNLOAD_ERROR = 'downloadError'\r\n}\r\n\r\n/**\r\n * Builder event interface\r\n */\r\nexport interface IBuilderEvent {\r\n  type: BuilderEventType;\r\n  data?: Record<string, unknown>;\r\n  timestamp: Date;\r\n}\r\n\r\n/**\r\n * Builder event listener interface\r\n */\r\nexport interface IBuilderEventListener {\r\n  (event: IBuilderEvent): void;\r\n}\r\n\r\n/**\r\n * Builder validation result interface\r\n */\r\nexport interface IBuilderValidationResult {\r\n  /** Whether the builder is valid */\r\n  isValid: boolean;\r\n  /** Validation errors */\r\n  errors: string[];\r\n  /** Validation warnings */\r\n  warnings: string[];\r\n  /** Worksheet validation results */\r\n  worksheetResults: Map<string, boolean>;\r\n} ","/**\r\n * ExcelBuilder - Main class for creating Excel workbooks\r\n */\r\n\r\nimport ExcelJS from 'exceljs';\r\nimport saveAs from 'file-saver';\r\nimport { EventEmitter } from '../utils/EventEmitter';\r\nimport { Worksheet } from './Worksheet';\r\nimport {\r\n  IExcelBuilder,\r\n  IExcelBuilderConfig,\r\n  IBuildOptions,\r\n  IDownloadOptions,\r\n  IBuildStats,\r\n  BuilderEventType,\r\n  IBuilderEvent,\r\n  ErrorType\r\n} from '../types/builder.types';\r\nimport {\r\n  IWorksheet,\r\n  IWorksheetConfig\r\n} from '../types/worksheet.types';\r\nimport { \r\n  Result,\r\n  ISuccessResult,\r\n  IErrorResult\r\n} from '../types/core.types';\r\n\r\n/**\r\n * ExcelBuilder class for creating Excel workbooks\r\n */\r\nexport class ExcelBuilder implements IExcelBuilder {\r\n  public config: IExcelBuilderConfig;\r\n  public worksheets: Map<string, IWorksheet> = new Map();\r\n  public currentWorksheet: IWorksheet | undefined;\r\n  public isBuilding = false;\r\n  public stats: IBuildStats;\r\n\r\n  private eventEmitter: EventEmitter;\r\n\r\n  constructor(config: IExcelBuilderConfig = {}) {\r\n    this.config = {\r\n      enableValidation: true,\r\n      enableEvents: true,\r\n      enablePerformanceMonitoring: false,\r\n      maxWorksheets: 255,\r\n      maxRowsPerWorksheet: 1048576,\r\n      maxColumnsPerWorksheet: 16384,\r\n      memoryLimit: 100 * 1024 * 1024, // 100MB\r\n      ...config\r\n    };\r\n\r\n    this.stats = this.initializeStats();\r\n    this.eventEmitter = new EventEmitter();\r\n  }\r\n\r\n  /**\r\n   * Add a new worksheet to the workbook\r\n   */\r\n  addWorksheet(name: string, worksheetConfig: Partial<IWorksheetConfig> = {}): IWorksheet {\r\n    if (this.worksheets.has(name)) {\r\n      throw new Error(`Worksheet \"${name}\" already exists`);\r\n    }\r\n\r\n    const config: IWorksheetConfig = {\r\n      name,\r\n      defaultRowHeight: 20,\r\n      defaultColWidth: 10,\r\n      ...this.config.defaultWorksheetConfig,\r\n      ...worksheetConfig\r\n    };\r\n\r\n    const worksheet = new Worksheet(config);\r\n    this.worksheets.set(name, worksheet);\r\n    this.currentWorksheet = worksheet;\r\n    \r\n    this.emitEvent(BuilderEventType.WORKSHEET_ADDED, { worksheetName: name });\r\n    \r\n    return worksheet;\r\n  }\r\n\r\n  /**\r\n   * Get a worksheet by name\r\n   */\r\n  getWorksheet(name: string): IWorksheet | undefined {\r\n    return this.worksheets.get(name);\r\n  }\r\n\r\n  /**\r\n   * Remove a worksheet by name\r\n   */\r\n  removeWorksheet(name: string): boolean {\r\n    const worksheet = this.worksheets.get(name);\r\n    if (!worksheet) {\r\n      return false;\r\n    }\r\n\r\n    this.worksheets.delete(name);\r\n    \r\n    // If this was the current worksheet, clear it\r\n    if (this.currentWorksheet === worksheet) {\r\n      this.currentWorksheet = undefined;\r\n    }\r\n    \r\n    this.emitEvent(BuilderEventType.WORKSHEET_REMOVED, { worksheetName: name });\r\n    \r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Set the current worksheet\r\n   */\r\n  setCurrentWorksheet(name: string): boolean {\r\n    const worksheet = this.worksheets.get(name);\r\n    if (!worksheet) {\r\n      return false;\r\n    }\r\n    \r\n    this.currentWorksheet = worksheet;\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Build the workbook and return as ArrayBuffer\r\n   */\r\n  async build(options: IBuildOptions = {}): Promise<Result<ArrayBuffer>> {\r\n    if (this.isBuilding) {\r\n      return {\r\n        success: false,\r\n        error: {\r\n          type: ErrorType.BUILD_ERROR,\r\n          message: 'Build already in progress',\r\n          stack: new Error().stack || ''\r\n        }\r\n      };\r\n    }\r\n\r\n    this.isBuilding = true;\r\n    const startTime = Date.now();\r\n    \r\n    try {\r\n      this.emitEvent(BuilderEventType.BUILD_STARTED);\r\n      \r\n      const workbook = new ExcelJS.Workbook();\r\n      \r\n      // Add metadata\r\n      if (this.config.metadata) {\r\n        workbook.creator = this.config.metadata.author || 'Han Excel Builder';\r\n        workbook.lastModifiedBy = this.config.metadata.author || 'Han Excel Builder';\r\n        workbook.created = this.config.metadata.created || new Date();\r\n        workbook.modified = this.config.metadata.modified || new Date();\r\n        if (this.config.metadata.title) workbook.title = this.config.metadata.title;\r\n        if (this.config.metadata.subject) workbook.subject = this.config.metadata.subject;\r\n        if (this.config.metadata.keywords) workbook.keywords = this.config.metadata.keywords;\r\n        if (this.config.metadata.category) workbook.category = this.config.metadata.category;\r\n        if (this.config.metadata.description) workbook.description = this.config.metadata.description;\r\n      }\r\n\r\n      // Build each worksheet\r\n      for (const worksheet of this.worksheets.values()) {\r\n        await (worksheet as Worksheet).build(workbook, options);\r\n      }\r\n\r\n      // Write to buffer\r\n      const buffer = await workbook.xlsx.writeBuffer({\r\n        compression: options.compressionLevel || 6\r\n      } as any);\r\n\r\n      const endTime = Date.now();\r\n      this.stats.buildTime = endTime - startTime;\r\n      this.stats.fileSize = buffer.byteLength;\r\n      \r\n      const successResult: ISuccessResult<ArrayBuffer> = {\r\n        success: true,\r\n        data: buffer\r\n      };\r\n\r\n      this.emitEvent(BuilderEventType.BUILD_COMPLETED, {\r\n        buildTime: this.stats.buildTime,\r\n        fileSize: this.stats.fileSize\r\n      });\r\n\r\n      return successResult;\r\n\r\n    } catch (error) {\r\n      const errorResult: IErrorResult = {\r\n        success: false,\r\n        error: {\r\n          type: ErrorType.BUILD_ERROR,\r\n          message: error instanceof Error ? error.message : 'Unknown build error',\r\n          stack: error instanceof Error ? error.stack || '' : ''\r\n        }\r\n      };\r\n\r\n      this.emitEvent(BuilderEventType.BUILD_ERROR, { error: errorResult.error });\r\n      return errorResult;\r\n\r\n    } finally {\r\n      this.isBuilding = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate and download the file\r\n   */\r\n  async generateAndDownload(fileName: string, options: IDownloadOptions = {}): Promise<Result<void>> {\r\n    const buildResult = await this.build(options);\r\n    \r\n    if (!buildResult.success) {\r\n      return buildResult;\r\n    }\r\n\r\n    try {\r\n      this.emitEvent(BuilderEventType.DOWNLOAD_STARTED, { fileName });\r\n      \r\n      const blob = new Blob([buildResult.data], { \r\n        type: options.mimeType || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \r\n      });\r\n      \r\n      saveAs(blob, fileName);\r\n      \r\n      this.emitEvent(BuilderEventType.DOWNLOAD_COMPLETED, { fileName });\r\n      \r\n      return { success: true, data: undefined };\r\n\r\n    } catch (error) {\r\n      const errorResult: IErrorResult = {\r\n        success: false,\r\n        error: {\r\n          type: ErrorType.BUILD_ERROR,\r\n          message: error instanceof Error ? error.message : 'Download failed',\r\n          stack: error instanceof Error ? error.stack || '' : ''\r\n        }\r\n      };\r\n\r\n      this.emitEvent(BuilderEventType.DOWNLOAD_ERROR, { error: errorResult.error });\r\n      return errorResult;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get workbook as buffer\r\n   */\r\n  async toBuffer(options: IBuildOptions = {}): Promise<Result<ArrayBuffer>> {\r\n    return this.build(options);\r\n  }\r\n\r\n  /**\r\n   * Get workbook as blob\r\n   */\r\n  async toBlob(options: IBuildOptions = {}): Promise<Result<Blob>> {\r\n    const buildResult = await this.build(options);\r\n    \r\n    if (!buildResult.success) {\r\n      return buildResult;\r\n    }\r\n\r\n    const blob = new Blob([buildResult.data], { \r\n      type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \r\n    });\r\n    \r\n    return { success: true, data: blob };\r\n  }\r\n\r\n  /**\r\n   * Validate the workbook\r\n   */\r\n  validate(): Result<boolean> {\r\n    const errors: string[] = [];\r\n    \r\n    if (this.worksheets.size === 0) {\r\n      errors.push('No worksheets found');\r\n    }\r\n\r\n    // Validate each worksheet\r\n    for (const [name, worksheet] of this.worksheets.entries()) {\r\n      const worksheetValidation = (worksheet as Worksheet).validate();\r\n      if (!worksheetValidation.success) {\r\n        errors.push(`Worksheet \"${name}\": ${worksheetValidation.error?.message}`);\r\n      }\r\n    }\r\n\r\n    if (errors.length > 0) {\r\n      return {\r\n        success: false,\r\n        error: {\r\n          type: ErrorType.VALIDATION_ERROR,\r\n          message: errors.join('; '),\r\n          stack: new Error().stack || ''\r\n        }\r\n      };\r\n    }\r\n\r\n    return { success: true, data: true };\r\n  }\r\n\r\n  /**\r\n   * Clear all worksheets\r\n   */\r\n  clear(): void {\r\n    this.worksheets.clear();\r\n    this.currentWorksheet = undefined;\r\n  }\r\n\r\n  /**\r\n   * Get workbook statistics\r\n   */\r\n  getStats(): IBuildStats {\r\n    return { ...this.stats };\r\n  }\r\n\r\n  /**\r\n   * Event handling methods\r\n   */\r\n  on(eventType: BuilderEventType, listener: (event: IBuilderEvent) => void): string {\r\n    return this.eventEmitter.on(eventType, listener);\r\n  }\r\n\r\n  off(eventType: BuilderEventType, listenerId: string): boolean {\r\n    return this.eventEmitter.off(eventType, listenerId);\r\n  }\r\n\r\n  removeAllListeners(eventType?: BuilderEventType): void {\r\n    if (eventType) {\r\n      this.eventEmitter.offAll(eventType);\r\n    } else {\r\n      this.eventEmitter.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Private methods\r\n   */\r\n  private emitEvent(type: BuilderEventType, data?: Record<string, unknown>): void {\r\n    const event: IBuilderEvent = {\r\n      type,\r\n      data: data || {},\r\n      timestamp: new Date()\r\n    };\r\n    this.eventEmitter.emitSync(event);\r\n  }\r\n\r\n  private initializeStats(): IBuildStats {\r\n    return {\r\n      totalWorksheets: 0,\r\n      totalCells: 0,\r\n      memoryUsage: 0,\r\n      buildTime: 0,\r\n      fileSize: 0,\r\n      stylesUsed: 0,\r\n      formulasUsed: 0,\r\n      conditionalFormatsUsed: 0,\r\n      performance: {\r\n        headersTime: 0,\r\n        dataTime: 0,\r\n        stylesTime: 0,\r\n        writeTime: 0\r\n      }\r\n    };\r\n  }\r\n} ","/**\r\n * StyleBuilder - Fluent API for creating Excel styles\r\n */\r\n\r\nimport {\r\n  IStyle,\r\n  IBorder,\r\n  IConditionalFormat,\r\n  IStyleBuilder as IStyleBuilderInterface\r\n} from '../types/style.types';\r\nimport { \r\n  Color, \r\n  HorizontalAlignment,\r\n  VerticalAlignment,\r\n  BorderStyle, \r\n  FontStyle \r\n} from '../types/core.types';\r\n\r\n/**\r\n * StyleBuilder class providing a fluent API for creating Excel styles\r\n */\r\nexport class StyleBuilder implements IStyleBuilderInterface {\r\n  private style: Partial<IStyle> = {};\r\n\r\n  constructor() {\r\n    // Configuración por defecto: wrapText true y alineación al centro\r\n    this.style.alignment = {\r\n      horizontal: HorizontalAlignment.CENTER,\r\n      vertical: VerticalAlignment.MIDDLE,\r\n      wrapText: true,\r\n      shrinkToFit: true\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a new StyleBuilder instance\r\n   */\r\n  static create(): StyleBuilder {\r\n    return new StyleBuilder();\r\n  }\r\n\r\n  /**\r\n   * Set font name\r\n   */\r\n  fontName(name: string): StyleBuilder {\r\n    if (!this.style.font) {\r\n      this.style.font = {};\r\n    }\r\n    this.style.font.name = name;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set font size\r\n   */\r\n  fontSize(size: number): StyleBuilder {\r\n    if (!this.style.font) {\r\n      this.style.font = {};\r\n    }\r\n    this.style.font.size = size;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set font style\r\n   */\r\n  fontStyle(style: FontStyle): StyleBuilder {\r\n    if (!this.style.font) {\r\n      this.style.font = {};\r\n    }\r\n    this.style.font.style = style;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set font color\r\n   */\r\n  fontColor(color: Color): StyleBuilder {\r\n    if (!this.style.font) {\r\n      this.style.font = {};\r\n    }\r\n    this.style.font.color = color;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Make font bold\r\n   */\r\n  fontBold(): StyleBuilder {\r\n    if (!this.style.font) {\r\n      this.style.font = {};\r\n    }\r\n    this.style.font.bold = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Make font italic\r\n   */\r\n  fontItalic(): StyleBuilder {\r\n    if (!this.style.font) {\r\n      this.style.font = {};\r\n    }\r\n    this.style.font.italic = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Make font underlined\r\n   */\r\n  fontUnderline(): StyleBuilder {\r\n    if (!this.style.font) {\r\n      this.style.font = {};\r\n    }\r\n    this.style.font.underline = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set border on all sides\r\n   */\r\n  border(style: BorderStyle, color?: Color): StyleBuilder {\r\n    if (!this.style.border) {\r\n      this.style.border = {};\r\n    }\r\n    const border: IBorder = { style };\r\n    if (color !== undefined) {\r\n      border.color = color;\r\n    }\r\n    this.style.border.top = border;\r\n    this.style.border.left = border;\r\n    this.style.border.bottom = border;\r\n    this.style.border.right = border;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set top border\r\n   */\r\n  borderTop(style: BorderStyle, color?: Color): StyleBuilder {\r\n    if (!this.style.border) {\r\n      this.style.border = {};\r\n    }\r\n    const border: IBorder = { style };\r\n    if (color !== undefined) {\r\n      border.color = color;\r\n    }\r\n    this.style.border.top = border;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set left border\r\n   */\r\n  borderLeft(style: BorderStyle, color?: Color): StyleBuilder {\r\n    if (!this.style.border) {\r\n      this.style.border = {};\r\n    }\r\n    const border: IBorder = { style };\r\n    if (color !== undefined) {\r\n      border.color = color;\r\n    }\r\n    this.style.border.left = border;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set bottom border\r\n   */\r\n  borderBottom(style: BorderStyle, color?: Color): StyleBuilder {\r\n    if (!this.style.border) {\r\n      this.style.border = {};\r\n    }\r\n    const border: IBorder = { style };\r\n    if (color !== undefined) {\r\n      border.color = color;\r\n    }\r\n    this.style.border.bottom = border;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set right border\r\n   */\r\n  borderRight(style: BorderStyle, color?: Color): StyleBuilder {\r\n    if (!this.style.border) {\r\n      this.style.border = {};\r\n    }\r\n    const border: IBorder = { style };\r\n    if (color !== undefined) {\r\n      border.color = color;\r\n    }\r\n    this.style.border.right = border;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set background color\r\n   */\r\n  backgroundColor(color: Color): StyleBuilder {\r\n    if (!this.style.fill) {\r\n      this.style.fill = { type: 'pattern' };\r\n    }\r\n    this.style.fill.backgroundColor = color;\r\n    this.style.fill.pattern = 'solid';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set horizontal alignment\r\n   */\r\n  horizontalAlign(alignment: HorizontalAlignment): StyleBuilder {\r\n    if (!this.style.alignment) {\r\n      this.style.alignment = {};\r\n    }\r\n    this.style.alignment.horizontal = alignment;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set vertical alignment\r\n   */\r\n  verticalAlign(alignment: VerticalAlignment): StyleBuilder {\r\n    if (!this.style.alignment) {\r\n      this.style.alignment = {};\r\n    }\r\n    this.style.alignment.vertical = alignment;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Center align text\r\n   */\r\n  centerAlign(): StyleBuilder {\r\n    if (!this.style.alignment) {\r\n      this.style.alignment = {};\r\n    }\r\n    this.style.alignment.horizontal = HorizontalAlignment.CENTER;\r\n    this.style.alignment.vertical = VerticalAlignment.MIDDLE;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Left align text\r\n   */\r\n  leftAlign(): StyleBuilder {\r\n    if (!this.style.alignment) {\r\n      this.style.alignment = {};\r\n    }\r\n    this.style.alignment.horizontal = HorizontalAlignment.LEFT;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Right align text\r\n   */\r\n  rightAlign(): StyleBuilder {\r\n    if (!this.style.alignment) {\r\n      this.style.alignment = {};\r\n    }\r\n    this.style.alignment.horizontal = HorizontalAlignment.RIGHT;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Wrap text\r\n   */\r\n  wrapText(): StyleBuilder {\r\n    if (!this.style.alignment) {\r\n      this.style.alignment = {};\r\n    }\r\n    this.style.alignment.wrapText = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set number format\r\n   */\r\n  numberFormat(format: string): StyleBuilder {\r\n    this.style.numberFormat = format;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set striped rows\r\n   */\r\n  striped(): StyleBuilder {\r\n    this.style.striped = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Add conditional formatting\r\n   */\r\n  conditionalFormat(format: IConditionalFormat): StyleBuilder {\r\n    if (!this.style.conditionalFormats) {\r\n      this.style.conditionalFormats = [];\r\n    }\r\n    this.style.conditionalFormats.push(format);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Build the final style\r\n   */\r\n  build(): IStyle {\r\n    return this.style as IStyle;\r\n  }\r\n\r\n  /**\r\n   * Reset the builder\r\n   */\r\n  reset(): StyleBuilder {\r\n    this.style = {};\r\n    // Restaurar configuración por defecto\r\n    this.style.alignment = {\r\n      horizontal: HorizontalAlignment.CENTER,\r\n      vertical: VerticalAlignment.MIDDLE,\r\n      wrapText: true\r\n    };\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Clone the current style\r\n   */\r\n  clone(): StyleBuilder {\r\n    const cloned = new StyleBuilder();\r\n    cloned.style = JSON.parse(JSON.stringify(this.style));\r\n    return cloned;\r\n  }\r\n} ","/**\r\n * Cell-specific type definitions\r\n */\r\n\r\nimport { IBaseCell } from './core.types';\r\nimport type { CellValue } from 'exceljs';\r\n\r\n/**\r\n * Header cell interface\r\n */\r\nexport interface IHeaderCell extends IBaseCell {\r\n  /** Reference to parent header key */\r\n  mainHeaderKey?: string;\r\n  /** Child headers */\r\n  children?: IHeaderCell[];\r\n  /** Whether this is a main header */\r\n  isMainHeader?: boolean;\r\n  /** Header level (1 = main, 2 = sub, etc.) */\r\n  level?: number;\r\n}\r\n\r\n/**\r\n * Data cell interface\r\n */\r\nexport interface IDataCell extends IBaseCell {\r\n  /** Reference to header key */\r\n  header: string;\r\n  /** Reference to main header key */\r\n  mainHeaderKey?: string;\r\n  /** Child data cells */\r\n  children?: IDataCell[];\r\n  /** Whether this cell has alternating row color */\r\n  striped?: boolean;\r\n  /** Row index */\r\n  rowIndex?: number;\r\n  /** Column index */\r\n  colIndex?: number;\r\n}\r\n\r\n/**\r\n * Footer cell interface\r\n */\r\nexport interface IFooterCell extends IBaseCell {\r\n  /** Reference to header key */\r\n  header: string;\r\n  /** Child footer cells */\r\n  children?: IDataCell[];\r\n  /** Whether this is a total row */\r\n  isTotal?: boolean;\r\n  /** Footer type */\r\n  footerType?: 'total' | 'subtotal' | 'average' | 'count' | 'custom';\r\n}\r\n\r\n/**\r\n * Cell position interface\r\n */\r\nexport interface ICellPosition {\r\n  /** Row index (1-based) */\r\n  row: number;\r\n  /** Column index (1-based) */\r\n  col: number;\r\n  /** Cell reference (e.g., A1) */\r\n  reference: string;\r\n}\r\n\r\n/**\r\n * Cell range interface\r\n */\r\nexport interface ICellRange {\r\n  /** Start position */\r\n  start: ICellPosition;\r\n  /** End position */\r\n  end: ICellPosition;\r\n  /** Range reference (e.g., A1:B10) */\r\n  reference: string;\r\n}\r\n\r\n/**\r\n * Cell data for different types\r\n */\r\nexport interface ICellData {\r\n  /** String cell data */\r\n  string?: {\r\n    value: string;\r\n    maxLength?: number;\r\n    trim?: boolean;\r\n  };\r\n  /** Number cell data */\r\n  number?: {\r\n    value: number;\r\n    min?: number;\r\n    max?: number;\r\n    precision?: number;\r\n    allowNegative?: boolean;\r\n  };\r\n  /** Date cell data */\r\n  date?: {\r\n    value: Date;\r\n    min?: Date;\r\n    max?: Date;\r\n    format?: string;\r\n  };\r\n  /** Boolean cell data */\r\n  boolean?: {\r\n    value: boolean;\r\n    trueText?: string;\r\n    falseText?: string;\r\n  };\r\n  /** Percentage cell data */\r\n  percentage?: {\r\n    value: number;\r\n    min?: number;\r\n    max?: number;\r\n    precision?: number;\r\n    showSymbol?: boolean;\r\n  };\r\n  /** Currency cell data */\r\n  currency?: {\r\n    value: number;\r\n    currency?: string;\r\n    precision?: number;\r\n    showSymbol?: boolean;\r\n  };\r\n  /** Link cell data */\r\n  link?: {\r\n    value: string;\r\n    text?: string;\r\n    tooltip?: string;\r\n  };\r\n  /** Formula cell data */\r\n  formula?: {\r\n    value: string;\r\n    result?: CellValue;\r\n  };\r\n}\r\n\r\n/**\r\n * Cell validation result\r\n */\r\nexport interface ICellValidationResult {\r\n  /** Whether the cell is valid */\r\n  isValid: boolean;\r\n  /** Validation errors */\r\n  errors: string[];\r\n  /** Validation warnings */\r\n  warnings: string[];\r\n}\r\n\r\n/**\r\n * Cell event types\r\n */\r\nexport enum CellEventType {\r\n  CREATED = 'created',\r\n  UPDATED = 'updated',\r\n  DELETED = 'deleted',\r\n  STYLED = 'styled',\r\n  VALIDATED = 'validated'\r\n}\r\n\r\n/**\r\n * Cell event interface\r\n */\r\nexport interface ICellEvent {\r\n  type: CellEventType;\r\n  cell: IDataCell | IHeaderCell | IFooterCell;\r\n  position: ICellPosition;\r\n  timestamp: Date;\r\n  data?: Record<string, unknown>;\r\n} ","/**\r\n * Worksheet-specific type definitions\r\n */\r\n\r\nimport { IHeaderCell, IDataCell, IFooterCell, ICellPosition, ICellRange } from './cell.types';\r\nimport { Color, Result } from './core.types';\r\n\r\n/**\r\n * Worksheet configuration interface\r\n */\r\nexport interface IWorksheetConfig {\r\n  /** Worksheet name */\r\n  name: string;\r\n  /** Tab color */\r\n  tabColor?: Color;\r\n  /** Default row height */\r\n  defaultRowHeight?: number;\r\n  /** Default column width */\r\n  defaultColWidth?: number;\r\n  /** Whether the worksheet is hidden */\r\n  hidden?: boolean;\r\n  /** Whether the worksheet is protected */\r\n  protected?: boolean;\r\n  /** Protection password */\r\n  protectionPassword?: string;\r\n  /** Whether to show grid lines */\r\n  showGridLines?: boolean;\r\n  /** Whether to show row and column headers */\r\n  showRowColHeaders?: boolean;\r\n  /** Zoom level (1-400) */\r\n  zoom?: number;\r\n  /** Freeze panes position */\r\n  freezePanes?: ICellPosition;\r\n  /** Print area */\r\n  printArea?: ICellRange;\r\n  /** Fit to page settings */\r\n  fitToPage?: {\r\n    fitToWidth?: number;\r\n    fitToHeight?: number;\r\n  };\r\n  /** Page setup */\r\n  pageSetup?: {\r\n    orientation?: 'portrait' | 'landscape';\r\n    paperSize?: number;\r\n    fitToPage?: boolean;\r\n    fitToWidth?: number;\r\n    fitToHeight?: number;\r\n    scale?: number;\r\n    horizontalCentered?: boolean;\r\n    verticalCentered?: boolean;\r\n    margins?: {\r\n      top?: number;\r\n      left?: number;\r\n      bottom?: number;\r\n      right?: number;\r\n      header?: number;\r\n      footer?: number;\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Table structure interface\r\n */\r\nexport interface ITable {\r\n  /** Table name */\r\n  name?: string;\r\n  /** Table headers */\r\n  headers?: IHeaderCell[];\r\n  /** Table sub-headers */\r\n  subHeaders?: IHeaderCell[];\r\n  /** Table data rows */\r\n  body?: IDataCell[];\r\n  /** Table footers */\r\n  footers?: IFooterCell[];\r\n  /** Table range */\r\n  range?: ICellRange;\r\n  /** Whether to show table borders */\r\n  showBorders?: boolean;\r\n  /** Whether to show alternating row colors */\r\n  showStripes?: boolean;\r\n  /** Table style */\r\n  style?: 'TableStyleLight1' | 'TableStyleLight2' | 'TableStyleMedium1' | 'TableStyleMedium2' | 'TableStyleDark1' | 'TableStyleDark2';\r\n}\r\n\r\n/**\r\n * Worksheet interface\r\n */\r\nexport interface IWorksheet {\r\n  /** Worksheet configuration */\r\n  config: IWorksheetConfig;\r\n  /** Tables in the worksheet */\r\n  tables: ITable[];\r\n  /** Current row pointer */\r\n  currentRow: number;\r\n  /** Current column pointer */\r\n  currentCol: number;\r\n  /** Header pointers for navigation */\r\n  headerPointers: Map<string, ICellPosition>;\r\n  /** Whether the worksheet has been built */\r\n  isBuilt: boolean;\r\n\r\n  /** Add a header */\r\n  addHeader(header: IHeaderCell): this;\r\n  /** Add subheaders */\r\n  addSubHeaders(subHeaders: IHeaderCell[]): this;\r\n  /** Add a row or rows */\r\n  addRow(row: IDataCell[] | IDataCell): this;\r\n  /** Add a footer or footers */\r\n  addFooter(footer: IFooterCell[] | IFooterCell): this;\r\n  /** Build the worksheet */\r\n  build(workbook: any, options?: any): Promise<void>;\r\n  /** Validate the worksheet */\r\n  validate(): Result<boolean>;\r\n}\r\n\r\n/**\r\n * Worksheet event types\r\n */\r\nexport enum WorksheetEventType {\r\n  CREATED = 'created',\r\n  UPDATED = 'updated',\r\n  DELETED = 'deleted',\r\n  TABLE_ADDED = 'tableAdded',\r\n  TABLE_REMOVED = 'tableRemoved',\r\n  CELL_ADDED = 'cellAdded',\r\n  CELL_UPDATED = 'cellUpdated',\r\n  CELL_DELETED = 'cellDeleted'\r\n}\r\n\r\n/**\r\n * Worksheet event interface\r\n */\r\nexport interface IWorksheetEvent {\r\n  type: WorksheetEventType;\r\n  worksheet: IWorksheet;\r\n  data?: Record<string, unknown>;\r\n  timestamp: Date;\r\n}\r\n\r\n/**\r\n * Worksheet validation result\r\n */\r\nexport interface IWorksheetValidationResult {\r\n  /** Whether the worksheet is valid */\r\n  isValid: boolean;\r\n  /** Validation errors */\r\n  errors: string[];\r\n  /** Validation warnings */\r\n  warnings: string[];\r\n  /** Cell validation results */\r\n  cellResults: Map<string, boolean>;\r\n}\r\n\r\n/**\r\n * Worksheet statistics\r\n */\r\nexport interface IWorksheetStats {\r\n  /** Total number of cells */\r\n  totalCells: number;\r\n  /** Number of header cells */\r\n  headerCells: number;\r\n  /** Number of data cells */\r\n  dataCells: number;\r\n  /** Number of footer cells */\r\n  footerCells: number;\r\n  /** Number of tables */\r\n  tables: number;\r\n  /** Used range */\r\n  usedRange: ICellRange;\r\n  /** Memory usage in bytes */\r\n  memoryUsage: number;\r\n} ","/**\r\n * Style-specific type definitions\r\n */\r\n\r\nimport { \r\n  Color, \r\n  HorizontalAlignment, \r\n  VerticalAlignment, \r\n  BorderStyle, \r\n  FontStyle \r\n} from './core.types';\r\n\r\n/**\r\n * Font configuration interface\r\n */\r\nexport interface IFont {\r\n  /** Font name */\r\n  name?: string;\r\n  /** Font size */\r\n  size?: number;\r\n  /** Font style */\r\n  style?: FontStyle;\r\n  /** Font color */\r\n  color?: Color;\r\n  /** Whether the font is bold */\r\n  bold?: boolean;\r\n  /** Whether the font is italic */\r\n  italic?: boolean;\r\n  /** Whether the font is underlined */\r\n  underline?: boolean;\r\n  /** Whether the font is strikethrough */\r\n  strikethrough?: boolean;\r\n  /** Font family */\r\n  family?: string;\r\n  /** Font scheme */\r\n  scheme?: 'major' | 'minor' | 'none';\r\n}\r\n\r\n/**\r\n * Border configuration interface\r\n */\r\nexport interface IBorder {\r\n  /** Border style */\r\n  style?: BorderStyle;\r\n  /** Border color */\r\n  color?: Color;\r\n  /** Border width */\r\n  width?: number;\r\n}\r\n\r\n/**\r\n * Border sides interface\r\n */\r\nexport interface IBorderSides {\r\n  /** Top border */\r\n  top?: IBorder;\r\n  /** Left border */\r\n  left?: IBorder;\r\n  /** Bottom border */\r\n  bottom?: IBorder;\r\n  /** Right border */\r\n  right?: IBorder;\r\n  /** Diagonal border */\r\n  diagonal?: IBorder;\r\n  /** Diagonal direction */\r\n  diagonalDirection?: 'up' | 'down' | 'both';\r\n}\r\n\r\n/**\r\n * Fill pattern interface\r\n */\r\nexport interface IFill {\r\n  /** Fill type */\r\n  type: 'pattern' | 'gradient';\r\n  /** Pattern type (for pattern fills) */\r\n  pattern?: 'none' | 'solid' | 'darkGray' | 'mediumGray' | 'lightGray' | 'gray125' | 'gray0625' | 'darkHorizontal' | 'darkVertical' | 'darkDown' | 'darkUp' | 'darkGrid' | 'darkTrellis' | 'lightHorizontal' | 'lightVertical' | 'lightDown' | 'lightUp' | 'lightGrid' | 'lightTrellis';\r\n  /** Background color */\r\n  backgroundColor?: Color;\r\n  /** Foreground color */\r\n  foregroundColor?: Color;\r\n  /** Gradient type (for gradient fills) */\r\n  gradient?: 'linear' | 'path';\r\n  /** Gradient stops */\r\n  stops?: Array<{\r\n    position: number;\r\n    color: Color;\r\n  }>;\r\n  /** Gradient angle (for linear gradients) */\r\n  angle?: number;\r\n}\r\n\r\n/**\r\n * Alignment configuration interface\r\n */\r\nexport interface IAlignment {\r\n  /** Horizontal alignment */\r\n  horizontal?: HorizontalAlignment;\r\n  /** Vertical alignment */\r\n  vertical?: VerticalAlignment;\r\n  /** Text rotation (0-180 degrees) */\r\n  textRotation?: number;\r\n  /** Whether to wrap text */\r\n  wrapText?: boolean;\r\n  /** Whether to shrink text to fit */\r\n  shrinkToFit?: boolean;\r\n  /** Indent level */\r\n  indent?: number;\r\n  /** Whether to merge cells */\r\n  mergeCell?: boolean;\r\n  /** Reading order */\r\n  readingOrder?: 'left-to-right' | 'right-to-left';\r\n}\r\n\r\n/**\r\n * Protection configuration interface\r\n */\r\nexport interface IProtection {\r\n  /** Whether the cell is locked */\r\n  locked?: boolean;\r\n  /** Whether the cell is hidden */\r\n  hidden?: boolean;\r\n}\r\n\r\n/**\r\n * Conditional formatting interface\r\n */\r\nexport interface IConditionalFormat {\r\n  /** Condition type */\r\n  type: 'cellIs' | 'containsText' | 'beginsWith' | 'endsWith' | 'containsBlanks' | 'notContainsBlanks' | 'containsErrors' | 'notContainsErrors' | 'timePeriod' | 'top' | 'bottom' | 'aboveAverage' | 'belowAverage' | 'duplicateValues' | 'uniqueValues' | 'expression' | 'colorScale' | 'dataBar' | 'iconSet';\r\n  /** Condition operator */\r\n  operator?: 'between' | 'notBetween' | 'equal' | 'notEqual' | 'greaterThan' | 'lessThan' | 'greaterThanOrEqual' | 'lessThanOrEqual';\r\n  /** Condition values */\r\n  values?: Array<string | number | Date>;\r\n  /** Condition formula */\r\n  formula?: string;\r\n  /** Style to apply when condition is met */\r\n  style?: IStyle;\r\n  /** Priority of the condition */\r\n  priority?: number;\r\n  /** Whether to stop if true */\r\n  stopIfTrue?: boolean;\r\n}\r\n\r\n/**\r\n * Main style interface\r\n */\r\nexport interface IStyle {\r\n  /** Font configuration */\r\n  font?: IFont;\r\n  /** Border configuration */\r\n  border?: IBorderSides;\r\n  /** Fill configuration */\r\n  fill?: IFill;\r\n  /** Alignment configuration */\r\n  alignment?: IAlignment;\r\n  /** Protection configuration */\r\n  protection?: IProtection;\r\n  /** Conditional formatting */\r\n  conditionalFormats?: IConditionalFormat[];\r\n  /** Number format */\r\n  numberFormat?: string;\r\n  /** Whether to apply alternating row colors */\r\n  striped?: boolean;\r\n  /** Custom CSS-like properties */\r\n  custom?: Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * Style preset types\r\n */\r\nexport enum StylePreset {\r\n  HEADER = 'header',\r\n  SUBHEADER = 'subheader',\r\n  DATA = 'data',\r\n  FOOTER = 'footer',\r\n  TOTAL = 'total',\r\n  HIGHLIGHT = 'highlight',\r\n  WARNING = 'warning',\r\n  ERROR = 'error',\r\n  SUCCESS = 'success',\r\n  INFO = 'info'\r\n}\r\n\r\n/**\r\n * Style theme interface\r\n */\r\nexport interface IStyleTheme {\r\n  /** Theme name */\r\n  name: string;\r\n  /** Theme description */\r\n  description?: string;\r\n  /** Color palette */\r\n  colors: {\r\n    primary: Color;\r\n    secondary: Color;\r\n    accent: Color;\r\n    background: Color;\r\n    text: Color;\r\n    border: Color;\r\n    success: Color;\r\n    warning: Color;\r\n    error: Color;\r\n    info: Color;\r\n  };\r\n  /** Font family */\r\n  fontFamily: string;\r\n  /** Base font size */\r\n  fontSize: number;\r\n  /** Style presets */\r\n  presets: Record<StylePreset, IStyle>;\r\n}\r\n\r\n/**\r\n * Style builder interface\r\n */\r\nexport interface IStyleBuilder {\r\n  /** Set font name */\r\n  fontName(name: string): IStyleBuilder;\r\n  /** Set font size */\r\n  fontSize(size: number): IStyleBuilder;\r\n  /** Set font style */\r\n  fontStyle(style: FontStyle): IStyleBuilder;\r\n  /** Set font color */\r\n  fontColor(color: Color): IStyleBuilder;\r\n  /** Make font bold */\r\n  fontBold(): IStyleBuilder;\r\n  /** Make font italic */\r\n  fontItalic(): IStyleBuilder;\r\n  /** Make font underlined */\r\n  fontUnderline(): IStyleBuilder;\r\n  /** Set border */\r\n  border(style: BorderStyle, color?: Color): IStyleBuilder;\r\n  /** Set specific border */\r\n  borderTop(style: BorderStyle, color?: Color): IStyleBuilder;\r\n  borderLeft(style: BorderStyle, color?: Color): IStyleBuilder;\r\n  borderBottom(style: BorderStyle, color?: Color): IStyleBuilder;\r\n  borderRight(style: BorderStyle, color?: Color): IStyleBuilder;\r\n  /** Set background color */\r\n  backgroundColor(color: Color): IStyleBuilder;\r\n  /** Set horizontal alignment */\r\n  horizontalAlign(alignment: HorizontalAlignment): IStyleBuilder;\r\n  /** Set vertical alignment */\r\n  verticalAlign(alignment: VerticalAlignment): IStyleBuilder;\r\n  /** Center align text */\r\n  centerAlign(): IStyleBuilder;\r\n  /** Left align text */\r\n  leftAlign(): IStyleBuilder;\r\n  /** Right align text */\r\n  rightAlign(): IStyleBuilder;\r\n  /** Wrap text */\r\n  wrapText(): IStyleBuilder;\r\n  /** Set number format */\r\n  numberFormat(format: string): IStyleBuilder;\r\n  /** Set striped rows */\r\n  striped(): IStyleBuilder;\r\n  /** Add conditional formatting */\r\n  conditionalFormat(format: IConditionalFormat): IStyleBuilder;\r\n  /** Build the final style */\r\n  build(): IStyle;\r\n} "],"names":["EventEmitter","listeners","Map","on","type","listener","options","this","has","set","registration","once","async","priority","stopPropagation","id","generateId","active","timestamp","Date","get","push","sort","a","b","off","listenerId","index","findIndex","reg","splice","offAll","count","length","delete","emit","event","activeListeners","filter","error","console","cleanupInactiveListeners","emitSync","clear","getListeners","getListenerCount","getEventTypes","Array","from","keys","Math","random","toString","substr","CellType","NumberFormat","HorizontalAlignment","VerticalAlignment","BorderStyle","FontStyle","ErrorType","Worksheet","config","tables","currentRow","currentCol","headerPointers","isBuilt","headers","subHeaders","body","footers","constructor","addHeader","header","addSubHeaders","addRow","row","isArray","addFooter","footer","build","workbook","_options","ws","addWorksheet","name","properties","defaultRowHeight","tabColor","pageSetup","rowPointer","forEach","value","mergeCell","mergeCells","getMaxColumns","styles","getRow","eachCell","cell","style","convertStyle","buildNestedHeaders","addDataRowRecursive","addFooterRow","startRow","maxDepth","getMaxHeaderDepth","depth","colIndex","headerInfo","getHeaderAtDepth","getCell","colSpan","children","child","String","calculateHeaderColSpan","applyAllMerges","startCol","log","mergeRange","start","end","childColSpan","endRow","applySmartMerges","applySmartMergesForHeader","headerColSpan","childColIndex","reduce","total","childDepth","max","maxCols","validate","success","data","VALIDATION_ERROR","message","calculateDataColumnPositions","positions","key","columnPositions","footerColPosition","excelRow","footerCell","numberFormat","numFmt","mergeTo","colPosition","childCell","jump","mainColPosition","mainCell","converted","font","family","size","bold","italic","underline","color","fill","pattern","fgColor","foregroundColor","bgColor","backgroundColor","border","top","left","bottom","right","alignment","horizontal","vertical","wrapText","indent","BuilderEventType","ExcelBuilder","worksheets","currentWorksheet","isBuilding","stats","eventEmitter","enableValidation","enableEvents","enablePerformanceMonitoring","maxWorksheets","maxRowsPerWorksheet","maxColumnsPerWorksheet","memoryLimit","initializeStats","worksheetConfig","Error","defaultColWidth","defaultWorksheetConfig","worksheet","emitEvent","WORKSHEET_ADDED","worksheetName","getWorksheet","removeWorksheet","WORKSHEET_REMOVED","setCurrentWorksheet","BUILD_ERROR","stack","startTime","now","BUILD_STARTED","ExcelJS","Workbook","metadata","creator","author","lastModifiedBy","created","modified","title","subject","keywords","category","description","values","buffer","xlsx","writeBuffer","compression","compressionLevel","endTime","buildTime","fileSize","byteLength","successResult","BUILD_COMPLETED","errorResult","generateAndDownload","fileName","buildResult","DOWNLOAD_STARTED","blob","Blob","mimeType","saveAs","DOWNLOAD_COMPLETED","DOWNLOAD_ERROR","toBuffer","toBlob","errors","entries","worksheetValidation","join","getStats","eventType","removeAllListeners","totalWorksheets","totalCells","memoryUsage","stylesUsed","formulasUsed","conditionalFormatsUsed","performance","headersTime","dataTime","stylesTime","writeTime","StyleBuilder","CENTER","MIDDLE","shrinkToFit","create","fontName","fontSize","fontStyle","fontColor","fontBold","fontItalic","fontUnderline","borderTop","borderLeft","borderBottom","borderRight","horizontalAlign","verticalAlign","centerAlign","leftAlign","LEFT","rightAlign","RIGHT","format","striped","conditionalFormat","conditionalFormats","reset","clone","cloned","JSON","parse","stringify","CellEventType","WorksheetEventType","StylePreset"],"mappings":"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"}